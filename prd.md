# Video ReHasher 软件开发需求文档

## 1. 项目概述
**项目名称**：Video ReHasher  
**核心功能**：批量扫描指定目录下的视频文件，修改视频签名（通过修改视频内容实现），并将处理后的文件保存到目标目录。  
**目标平台**：macOS 和 Windows。  
**技术栈建议**：Flutter（支持桌面端），使用 FFmpeg 进行视频处理。

---

## 2. 功能需求

### 2.1 文件选择与扫描
- 用户可选择源目录（包含待处理视频）和目标目录（保存修改后的文件）。
- 自动扫描源目录下所有支持格式的视频文件（包括子目录）。
- 扫描完成后，以列表形式展示可处理的文件（包含文件名、格式、大小等信息）。

### 2.2 视频格式支持
- 支持常见视频格式：MP4、AVI、MOV、MKV、FLV、WMV、WebM。
- 可扩展：预留接口以便未来添加更多格式。

### 2.3 视频签名修改
- 通过修改视频内容（如插入元数据、微调帧数据）实现签名修改，确保不破坏视频可播放性。
- 使用 FFmpeg 命令行工具或 lib 库进行视频处理（需内置或动态检测 FFmpeg）。

### 2.4 批量处理与进度展示
- 支持批量处理，可暂停/继续（可选功能）。
- 实时进度显示：整体进度条 + 单个文件处理进度（百分比、速度、剩余时间）。
- 处理完成后提示用户，并支持打开目标目录。

---

## 3. 非功能需求

### 3.1 用户界面（UI/UX）
- **设计风格**：现代化、简洁、大方，符合 macOS和 Windows原生风格。
- **布局要求**：
  - 顶部：标题和版本信息。
  - 主体：左侧为目录选择区域，右侧为文件列表和进度展示。
  - 底部：操作按钮（开始、暂停、取消）。
- **进度动画**：使用平滑的进度条+文字说明（如“处理中：4/10 文件，剩余时间 2 分钟”）。

### 3.2 性能与兼容性
- 支持大文件（如 4GB 以上）高效处理。
- 多线程处理，避免界面卡顿。
- 优先使用支持ffmpeg的flutter库。

---

## 4. 技术实现建议

### 4.1 开发框架与工具
- **UI 框架**：Flutter 3.x（支持 macOS/Windows 桌面端）。
- **视频处理**：集成 `ffmpeg_cli` 或 `dart_ffmpeg` 调用 FFmpeg。
- **依赖管理**：Pub 包管理，关键包建议：
  - `file_picker`：目录选择。
  - `provider` 或 `riverpod`：状态管理。
  - `syncfusion_flutter_gauges`：美观进度组件（可选）。

### 4.2 关键代码逻辑

```dart
// 伪代码示例
void processVideo(String inputPath, String outputPath) {
  // 调用API解码视频，并进行处理
}
```

### 4.3 跨平台适配
- 区分 macOS/Windows 路径处理（`path` 包）。
- 平台特定 UI 适配（如菜单栏、窗口控件）。

---

## 5. 输出要求
- 处理后的文件保持原格式，命名规则：`原文件名_rehashed.扩展名`。
- 日志记录：成功/失败文件列表，错误原因（如格式不支持）。

---

## 6. 测试验证
- 单元测试：文件扫描、FFmpeg 调用验证。
- 界面测试：进度显示、跨平台渲染一致性。
- 真实视频批量处理测试（≥10 个文件）。

---

## 7. 备注
- 优先实现核心功能，高级功能（如暂停、配置预设）可列为二期需求。
- 确保 FFmpeg 许可证合规（建议提示用户自行安装）。

---

请根据此文档生成 Flutter 代码，并分阶段实现：  
1. 基础 UI 框架（目录选择+文件列表）。  
2. 集成 FFmpeg 调用。  
3. 进度监控与美化。  
4. 跨平台调试与打包。